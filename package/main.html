<html><head><title>Duet WebGL - AP</title><meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1"/><meta name="viewport" content="width=device-width, minimum-scale=1.0, initial-scale=1, user-scalable=yes"/><script src="bower_components/webcomponentsjs/webcomponents-lite.min.js"></script><link href="elements.html" rel="import"/><style is="custom-style" include="iron-flex iron-flex-alignment iron-flex-factors iron-positioning"></style><link rel="stylesheet" async="async" href="https://fonts.googleapis.com/css?family=Open+Sans+Condensed:300|Poiret+One|Roboto"/><script src="bower_components/phaser/build/phaser.min.js"></script></head><body class="fullbleed"><style>body,head,html{margin:0;padding:0;border:0;background:#1D1D1D;overflow:hidden}h1,h2,h3{font-family:"Poiret One";font-weight:200}canvas{height:100%;width:100%}</style><style is="custom-style">.nav-bar,paper-toolbar{width:100%;left:0;position:absolute}.creator,.nav-bar,paper-toolbar{position:absolute}paper-toolbar{background-color:transparent;top:0}paper-toolbar[nw]{top:2em}.scrubber{-webkit-app-region:drag;cursor:move;background-image:-webkit-repeating-radial-gradient(center center,rgba(0,0,0,.2),rgba(0,0,0,.2) 1px,transparent 1px,transparent 100%);background-image:-moz-repeating-radial-gradient(center center,rgba(0,0,0,.2),rgba(0,0,0,.2) 1px,transparent 1px,transparent 100%);background-image:-ms-repeating-radial-gradient(center center,rgba(0,0,0,.2),rgba(0,0,0,.2) 1px,transparent 1px,transparent 100%);background-image:repeating-radial-gradient(center center,rgba(0,0,0,.2),rgba(0,0,0,.2) 1px,transparent 1px,transparent 100%);-webkit-background-size:3px 3px;-moz-background-size:3px 3px;background-size:3px 3px}.nav-bar{background:rgba(255,255,255,.08);height:2em;top:0;text-align:right}.nav-bar .btn{color:#fff;width:4em;height:100%;text-align:center;display:inline-block;transition:background-color .25s}.nav-bar .btn>*{height:100%;padding:6px}.nav-bar .close.btn:hover{background:#c62828}.nav-bar .min.btn:hover{background:rgba(255,255,255,.21)}.creator{bottom:0;font-family:Poiret One;color:rgba(255,255,255,.11);font-size:.8em;right:5px;transition:color .25s}.creator:hover{color:rgba(255,255,255,.41)}.creator a{text-decoration:none;color:inherit}</style><template id="app" is="dom-bind"><audio src="[[track]]" loop="loop" autoplay="autoplay"></audio><paper-toolbar nw$="[[isNodeWebkit]]"><h1>Duet</h1><div class="flex"></div><h3>Score: [[round(score)]]</h3></paper-toolbar><header class="nav-bar layout horizontal" hidden$="[[!isNodeWebkit]]"><div class="flex scrubber"></div><div class="btn min"><paper-icon-button icon="remove" on-tap="minimize"></paper-icon-button></div><div class="btn close"><paper-icon-button icon="close" on-tap="exit"></paper-icon-button></div></header></template><footer class="creator"><a class="AP" href="http://linkedin.com/in/apoorvverma" target="_blank">Created by Apoorv Verma [AP]</a></footer><script>"use strict";function _toConsumableArray(t){if(Array.isArray(t)){for(var e=0,n=Array(t.length);e<t.length;e++)n[e]=t[e];return n}return Array.from(t)}Array.prototype.make=function(t){return Array.apply(0,Array(t)).map(function(t,e){return e})},Array.prototype.flatten=function(){var t=[];return this.forEach(function(e){return e instanceof Array?t.push.apply(t,_toConsumableArray(e)):t.push(e)}),t},Number.prototype.rangeRandom=function(t,e){return Math.random()*(e-t)+t},String.prototype.titleCase=function(){for(var t=this.toLowerCase().split(" "),e=0;e<t.length;e++)t[e]=t[e].charAt(0).toUpperCase()+t[e].slice(1);return t.join(" ")};var t=document.querySelector("#app"),game,bs,wl;navigator.vibrate=navigator.vibrate||navigator.webkitVibrate||navigator.mozVibrate||navigator.msVibrate||function(t){},t.vibrate=function(t){return navigator.vibrate(t)},t.isNodeWebkit="undefined"!=typeof require,t.debug=!1,t.w_spin=[],t.w_snap=[],t.sprinkleBack=[],t.score=0,t.level=1,t.track="public/theme.ogg",t.round=function(t){return Math.round(t)},t.minimize=function(e){return t.nw?t.nw.gui.Window.get().minimize():alert("No can do minimizing!")},t.exit=function(e){return t.nw?t.nw.gui.App.quit():window.close()},t.sleep=function(t){return new Promise(function(e){return setTimeout(e,t)})},t.distanceFormula=function(t,e){return Math.sqrt(Math.pow(t.x-e.x,2)+Math.pow(t.y-e.y,2))},t.isNodeWebkit?(t.getLevel=function(t){return require("../levels/"+t+".json")},t.nw={gui:require("nw.gui")}):t.getLevel=function(t){return 1==t?{walls:[{type:"left"},{type:"center"},{type:"left"},{type:"left"},{type:"right"}],track:"public/lv1.ogg"}:2==t?{walls:[{type:"left"},{type:"center"},{type:"spin"},{type:"center"},{type:"spin",dir:1},{type:"left"},{type:"right"},{type:"left"},{type:"center"}],track:"public/lv1.ogg"}:3==t?{walls:[{type:"narrow"},{type:"center"},{type:"spin"},{type:"spin",dir:1},{type:"center"},{type:"center"},{type:"narrow"},{type:"narrow"},{type:"left"},{type:"right"}],track:"public/lv1.ogg"}:4==t?{walls:[{type:"narrow"},{type:"center"},{type:"spin",dir:1},{type:"spin"},{type:"spin"},{type:"spin",dir:1},{type:"spin",dir:1},{type:"spin"},{type:"narrow"},{type:"right"}],track:"public/lv2.ogg"}:{walls:[{type:"snap"},{type:"center"},{type:"snap",dir:1},{type:"spin"},{type:"snap"},{type:"spin"},{type:"spin",dir:1},{type:"snap",dir:1},{type:"spin"},{type:"snap"},{type:"center"},{type:"narrow"},{type:"right"}],track:"public/lv2.ogg"}},t.setScore=function(e){clearInterval(t.curInt);var n={in:(e-t.score)/30,f:e},r=n.in<0;t.curInt=setInterval(function(e){t.score=t.score+n.in,(r?t.score<=n.f:t.score>=n.f)&&(t.score=n.f,clearInterval(t.curInt))},30)},t.gameSetup=function(t){},t.gameSetup.prototype={preload:function(){var t=.875*game.height,e=game.world.centerX,n=150,r=.22,a=function(t,e){var n=game.add.bitmapData(t,e);return n.ctx.beginPath(),n.ctx.rect(0,0,t,e),n.ctx.fillStyle="#ffffff",n.ctx.closePath(),n.ctx.fill(),n},i=function(t,e){e=e||10;var n=game.add.bitmapData(2*e,2*e);return n.ctx.fillStyle=t,n.ctx.beginPath(),n.ctx.arc(e,e,e,0,2*Math.PI,!1),n.ctx.closePath(),n.ctx.fill(),n},o=function(t){var e=new Phaser.Polygon(t.flatten()),n=game.add.graphics(0,0);n.beginFill(16777215),n.drawPolygon(e.points),n.endFill();var r=n.generateTexture();return n.destroy(),r},s=game.add.graphics(e,t);s.lineStyle(1,8816262),s.alpha=.5,this.disk=s.arc(0,0,e*r,0,2*Math.PI,!1),this.config={moved:0,SpinFunc:function(t,e,n){return((t||-1)*game.speed*.98*(e-n)+90)%360},SnapFunc:function(t,e,n){return-1*(t||-1)*Number(e>n)},ball_velocity:3.327484130859375,WALL_H:30,PAD:{basic:n,spin:1.3*n},W_OFFSET:e,H_OFFSET:t,BALL_RAD:r,MakeRect:a,MakeCircle:i,MakePolygon:o}},keyBindings:function(){this.cursors=game.input.keyboard.createCursorKeys();var t=Phaser.Keyboard,e=game.input.keyboard.addKey(t.LEFT),n=game.input.keyboard.addKey(t.RIGHT);game.input.keyboard.addKey(t.r).onDown.add(this.resetGame,this),e.onDown.add(this.spinLeft,this),n.onDown.add(this.spinRight,this),e.onUp.add(this.spinLeftDone,this),n.onUp.add(this.spinRightDone,this)},spinLeft:function(){bs.lPressed=!!(bs.rotate="left")},spinRight:function(){bs.rPressed=!!(bs.rotate="right")},spinRightDone:function(){bs.rPressed=!1,bs.rotate=bs.lPressed&&"left"},spinLeftDone:function(){bs.lPressed=!1,bs.rotate=bs.rPressed&&"right"},create:function(){var e=this;t.gameSleep=function(t){return new Promise(function(n){return game.time.events.add(t,function(t){return n(e)},e)})},game.scale.pageAlignHorizontally=game.scale.pageAlignVertically=!0,game.scale.scaleMode=Phaser.ScaleManager.SHOW_ALL,game.speed=4,this.keyBindings();var n=game.physics;n.startSystem(Phaser.Physics.P2JS),n.p2.setImpactEvents(!0),n.p2.restitution=.8,this.BallCG=n.p2.createCollisionGroup(),this.WallCG=n.p2.createCollisionGroup();var r=this.config;this.balls=bs=game.add.group(),this.walls=wl=game.add.group(),this.particlesGroup=game.add.group(),[wl,bs,this.particlesGroup].forEach(function(t){t.enableBody=!0,t.physicsBodyType=Phaser.Physics.P2JS}),this.ballX=bs.create(r.W_OFFSET*(1-r.BALL_RAD),r.H_OFFSET,r.MakeCircle("#FF0000",11)),this.ballY=bs.create(r.W_OFFSET*(1+r.BALL_RAD),r.H_OFFSET,r.MakeCircle("#2196F3",11)),this.ballX.tint=16711680,this.ballY.tint=2201331,this.makeWalls(t.getLevel(t.level),this);var a=function(t){return[250,Phaser.Easing.Linear.None,!0,0,t,!0]};wl.children.forEach(function(t,e){var n;return(n=game.add.tween(t.scale)).to.apply(n,[{x:1.05,y:1.15}].concat(_toConsumableArray(a(250*(e+1)))))}),[this.ballX,this.ballY].forEach(function(t){t.body.setCircle(t.width/2),t.body.fixedRotation=!0,t.body.setCollisionGroup(e.BallCG),t.body.collides([e.WallCG,e.BallCG]),t.anchor.set(.5,.5),t.body.kinematic=!0,t.body.createGroupCallback(e.WallCG,e.ballSplat,e)}),app.c=this,t.wlPos=wl.children.map(function(t){return{x:t.position.x,y:t.position.y,deg:t.body.angle}}),wl.setAll("body.velocity.y",0),game.camera.follow(this.center)},makeWalls:function(e,n){var r=this.config,a=1.05*r.W_OFFSET,i=22;t.track=e.track;var o=0,s=function(t,e,n,s){var l=function(t,e){return r.MakeRect(t,e)},c=function(t,e,n){return{left:0+e/2,right:game.width-e/2,center:r.W_OFFSET,spin:r.W_OFFSET,narrow:0+e/2,snap:0+e/2,"snap_2nd.0":e+n/2+1,"snap_2nd.1":game.width-e-n/2-1}[t]},p={left:[a,r.WALL_H],right:[a,r.WALL_H],center:[.15*r.W_OFFSET,.15*r.W_OFFSET],spin:[.45*r.W_OFFSET,r.WALL_H],narrow:[r.W_OFFSET-3*i,r.WALL_H],snap:[1.2*r.W_OFFSET-3.5*i,r.WALL_H]},u=p[e],d=r.H_OFFSET/4;if(!u)return void console.warn("[WALL-MAKER]","No type defined as",e);var h=u[0],y=u[1],f=l(h,y),g=["spin","snap"].indexOf(e)+1;g&&(o+=r.PAD.spin-r.PAD.basic);var m=t.create(c(e,h),d-o,f),b=[m];if("narrow"==e){var v=(l(h,y),t.create(c("right",h),d-o,f));v.body.setRectangle(h,y),b.push(v)}else if("snap"==e){var w=r.WALL_H/2,F=3.5*i/2,_=(r.W_OFFSET-2*F)/2,k=[[-_,w],[-_,-w],[_-.5*F,-w],[_,0],[_-.5*F,w]],P=[[-F,w],[-.5*F,0],[-F,-w],[.5*F,-w],[F,0],[.5*F,w]],E=r.MakePolygon(k),S=r.MakePolygon(P);m.destroy(),m=t.create(c(s.dir?"right":"left",2*_),d-o,E),m.body.addPolygon({},k);var x=t.create(c("snap_2nd."+(s.dir||0),2*_,2*F),d-o,S);x.body.addPolygon({},P),s.dir&&(m.body.angle=x.body.angle=180),b.pop(),b.push(m),b.push(x)}return o+=r.PAD[g?"spin":"basic"],b};e.walls.forEach(function(e,a){var i=s(wl,e.type,a,e);i&&i.forEach(function(a,i){if(a.body.setCollisionGroup(n.WallCG),a.body.collides([n.WallCG,n.BallCG]),"spin"==e.type){var o=(r.H_OFFSET-(a.position.y+a.width/2))/r.ball_velocity;a.body.angle=r.SpinFunc(0,o),t.w_spin.push([{dir:e.dir,iters:o},a])}else if("snap"==e.type&&i){var s=(r.H_OFFSET-a.position.y)/r.ball_velocity;t.w_snap.push([{dir:e.dir,iters:s,x:a.position.x},a])}})})},update:function(){var e=this,n=this.config,r=game.input.activePointer,a=n.moved/200;if(game.complete||wl.children.forEach(function(t){return t.body.moveDown(200)}),game.complete||(n.moved+=200),r.isDown?(n.cursor=!0,bs.rotate=r.positionDown.x<n.W_OFFSET?"left":"right"):n.cursor&&(n.cursor=!1,bs.rotate=""),t.sprinkleBack.forEach(function(e,n){e()&&delete t.sprinkleBack[n]}),t.sprinkleBack=t.sprinkleBack.filter(function(t){return t}),!game.complete&&bs.rotate&&this.rotateBalls(),t.w_spin.length&&t.w_spin.forEach(function(t){t[1].body.fixedRotation=!1,t[1].body.angle=n.SpinFunc(t[0].dir,a,t[0].iters)}),t.w_snap.length&&t.w_snap.forEach(function(t){if(t[1].body){var e=1.75*n.BALL_RAD*n.W_OFFSET,r=n.SnapFunc(t[0].dir,a,t[0].iters),i=t[0].x+r*e,o=t[1].body;o.x!=i&&game.add.tween(t[1].body).to({x:i},50,Phaser.Easing.None,!0)}}),wl.children.slice(-1)[0].position.y>n.H_OFFSET+200&&!game.complete){game.complete=!0;var i=game.add.text(0,0,"You have completed the Level",{font:"40px 'Poiret One'",fill:"#FFFFFF",align:"center"});i.position.set(Math.floor(n.W_OFFSET-i.width/2),Math.floor(game.height/2-i.height/2)),t.setScore(t.score+50),t.gameSleep(1500).then(function(t){return e.LevelUp(e)})}},rotateBalls:function(){var t=this,e=this.config;bs.children.forEach(function(n){var r=t.ballX.body.angle+game.speed*("right"==bs.rotate?1:"left"==bs.rotate?-1:0),a=e.W_OFFSET*e.BALL_RAD,i=n.body,o=Math.PI/180,s=n==t.ballY,l=s?-1:1;n.body.angle=r+(s?180:0),i.x=e.W_OFFSET-a*Math.cos(r*o)*l,i.y=e.H_OFFSET-a*Math.sin(r*o)*l})},resetGame:function(){game.state.start("PlayGame",!0,!0)},resetAlignment:function(e){var n=this;return new Promise(function(r){t.sprinkleBack.push(function(t){var a=e.ballX;return Math.abs(a.body.angle%360)<10?(bs.rotate="",a.body.angle=0,n.rotateBalls(),r(),!0):(bs.rotate="left",void n.rotateBalls())})})},resetWalls:function(e){var n=e.config,r=(n.moved,function(t){return wl.children.forEach(function(e){var n=e.body;n.setZeroVelocity(),n.angularVelocity=0,n.kinematic=t,n.fixedRotation=t,n.angle=0})});return new Promise(function(e){r(!0),t.sprinkleBack.push(function(t){if(!n.moved)return e(),r(!1),!0;var a=n.moved<100?n.moved:Math.max(Math.pow(n.moved,.7),200);n.moved-=a,wl.children.forEach(function(t){t.body.moveUp(a)})})})},reviveBalls:function(){var t=this,e=[],n=this.sprinkleRevive.bind(this),r=t.config;return new Promise(function(a){t.ballX.alive||e.push(n(t.ballX,{x:r.W_OFFSET*(1-r.BALL_RAD),y:r.H_OFFSET})),t.ballY.alive||e.push(n(t.ballY,{x:r.W_OFFSET*(1+r.BALL_RAD),y:r.H_OFFSET})),Promise.all(e).then(a)})},resetVars:function(){t.w_spin=[],t.w_snap=[]},LevelUp:function(e){var n=this;e.config;this.resetAlignment(e).then(this.reviveBalls.bind(this)).then(function(e){t.level++,n.resetVars(),game.complete=!1,n.resetGame.bind(n)()})},ballSplat:function(e,n){var r=this,a=this;this.sprinkleDeath(e.sprite),t.vibrate([25,25,25]),n.sprite.tint=e.sprite.tint,game.complete=!0,Promise.all([this.resetAlignment(a),this.resetWalls(a)]).then(this.reviveBalls.bind(this)).then(function(e){t.w_spin=[],game.complete=!1,r.resetGame.bind(r)()})},sprinkleRevive:function(e,n){var r=this;return new Promise(function(a){var i=r.config,o="#"+Phaser.Color.componentToHex(e.tint),s=r.particlesGroup,l=[],c=[-999,0];[].make(25).forEach(function(r){var a=s.getFirstExists(!1)||s.create(0,0,i.MakeCircle(o,(0).rangeRandom(1,4))),p=a.body,u={x:i.W_OFFSET+i.W_OFFSET*(0).rangeRandom(-.75,.75),y:(0).rangeRandom(-300,0)},d=!1;u.y>c[0]&&(c=[u.y,r],d=!0),a.reset(u.x,u.y),a.alpha=.8,a.tint=e.tint,p.damping=.03,p.mass=.01,p.velocity.x=0,p.velocity.y=0,a.anchor.set(.5,.5),l.push(new Promise(function(e){var r=function(r){var i=a.position,o=Math.atan2(i.y-n.y,i.x-n.x),s=(d?75:0)+(0).rangeRandom(-15,15)+400*Math.sqrt(Math.sqrt((i.y-n.y)/(u.y-n.y))),l=400*Math.sqrt(Math.sqrt((i.x-n.x)/(u.x-n.x))),c=t.distanceFormula(i,n);if(p.rotation=o+game.math.degToRad(90),p.velocity.x=-Math.cos(o)*l,p.velocity.y=-Math.sin(o)*s,isNaN(c)||c<1)return p.velocity.x=p.velocity.y=0,a.kill(),e(),!0};t.sprinkleBack.push(r)}))}),l[c[1]].then(function(t){e.reset(n.x,n.y),e.scale.set(.1,.1),game.add.tween(e.scale).from({x:.1,y:.1}).to({x:1,y:1},50,Phaser.Easing.Linear.None,!0)}),Promise.all(l).then(function(t){return console.info("Promise fulfilled",e==r.ballX?"X":"Y")}).then(a)})},sprinkleDeath:function(t){var e=this.config,n=t.position,r="#"+Phaser.Color.componentToHex(t.tint),a=this.particlesGroup;[].make(50).forEach(function(i){var o=a.getFirstExists(!1)||a.create(0,0,e.MakeCircle(r,(0).rangeRandom(1,4))),s=o.body;o.reset(n.x,n.y),o.tint=t.tint,s.velocity.x=(0).rangeRandom(-100,100),s.force.y=100+(0).rangeRandom(-10,150),s.mass=.01,s.fixedRotation=!0,s.collideWorldBounds=!1,o.anchor.set(.5,.5),o.lifespan=3e3,o.alpha=.8}),t.kill()},render:function(){t.debug&&[this.particlesGroup,wl,bs].forEach(function(t){return t.children.forEach(function(t){return t.body.debug=!0})})}},window.onload=function(){game=t.g=new Phaser.Game(640,960,Phaser.AUTO,"",void 0,!0),game.state.add("PlayGame",t.gameSetup),game.state.start("PlayGame")};</script></body></html>